---
layout:     post
title:      Ajax
subtitle:   Ajax
date:       2019-12-04
author:     正版慕言
header-img: img/blog_bg_1.jpg
catalog: true
mathjax: true
tags:
    - Java
    - Ajax

---

> Ajax:Asynchronous Javascript And XML(异步Javascript和XML)，是一种创建交互式网页应用的网页开发技术。

服务器给客户端的响应一般是整个页面。但由于ajax中是局部刷新，服务器就不用响应整个页面，只响应数据即可。
- text
- xml
- json(最受欢迎的格式)

> 异步与同步：
> - 同步：发送一个请求之后，要等待服务器的响应结束才能再发送第二个请求。刷新的是整个页面
> - 异步：发送一个请求后无需等待服务器响应，就可以发送下一个请求。可以使用js接收服务器的响应，使用js来进行局部刷新

# ajax四部操作

- 得到XMLHttpRequest对象
    + 对大多数浏览器：var xmlHttp = new XMLHttpRequest();
    + IE6.0：var xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
    + IE5.5及更早的浏览器：var xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
    ```js
        function createXMLHttpRequest(){
            try{
                return new XMLHttpRequest();
            }catch(e){
                try{
                    return new ActiveXObject("Msxml2.XMLHTTP");
                }catch(d){
                    try{
                        return new ActiveXObject("Microsoft.XMLHTTP");
                    }catch(e){
                        alter("???");
                        throw e;
                    }
                }
            }
        }
    ```
- 使用xmlHttp.open()打开与服务器的连接。三个参数：
    + 请求方式：GET或POST
    + 请求的URL：指定服务器端的资源
    + 请求是否异步：true表示异步，否则同步
    + 例：xmlHttp.open("GET","/Demo/demo1", true);
- 发送请求：xmlHttp.send(null);
    + 如果是GET请求，由于没有请求体，必须给出参数null
- 在xmlHttp对象的 **onreadystatechange** 事件上注册监听器
    + xmlHttp对象有5个状态：
        * 0：刚创建尚未调用open()方法
        * 1：请求开始，尚未调用send()方法
        * 2：调用完成send()方法
        * 3：服务期开始响应，但未结束
        * 4：服务器响应结束
    + 得到xmlHttp对象的状态：var state = xmlHttp.readyState;
    + 得到服务器响应的状态码：var status = xmlHttp.status;
    + 得到服务器相应的内容：
        * 文本格式：var content = xmlHttp.responseText;
        * xml格式的Document对象：var content = xmlHttp.responseXML;


# XStream

> XStream可以把JavaBean转化为XML。

核心jar包：[xstream-1.4.10.jar](/downloads/xstream-1.4.10.jar)
必须依赖包：[xpp3_min-1.1.4c.jar](/downloads/xpp3_min-1.1.4c.jar)

```java
XStream xstream = new XStream();
String xmlStr = xstream.toXML(javabean);
```

- 按照需求修改元素名：xstream.alias("newname", Class.class);
- 默认类成员声成为元素。将其设置为属性：xstream.useAttributeFor(Class.class, "name") 将Class类中名为name的成员设置为属性
- 去除Collection类型的成名，只要其内容：xstream.addImplicitCollection(Class.class, "name") 让Class类的名为name（name是list类型，其内容还会生成元素）的成名不生成元素
- 去除类中的指定成员：xstream.omitField(Class.class, "name")

# json

> json是js提供的一种数据交换格式

语法：
- {} 表示对象
- 属性名使用双引号""
- 属性值：
    + null
    + 数值
    + 字符串
    + 数组，使用[]
    + boolean值，true或false

例：
```json
var person = {"name" : "zhangsan", "age" : 18, "sex" : "male"};
```

#### json-lib

> json-lib可以将Javabean转换成json串

核心jar包：
- [json-lib-2.4-jdk15.jar](/downloads/json-lib/json-lib-2.4-jdk15.jar)
依赖jar包：
- [commons-lang-2.4.jar](/downloads/json-lib/commons-lang-2.4.jar)
- [commons-beanutils-1.8.0.jar](/downloads/json-lib/commons-beanutils-1.8.0.jar)
- [commons-logging.jar](/downloads/json-lib/commons-logging.jar)
- [commons-collections-3.2.1.jar](/downloads/json-lib/commons-collections-3.2.1.jar)
- [ezmorph-1.0.6.jar](/downloads/json-lib/ezmorph-1.0.6.jar)