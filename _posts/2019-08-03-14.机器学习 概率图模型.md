---
layout:     post
title:      14.机器学习|概率图模型
subtitle:   机器学习周志华 学习笔记————机器学习|概率图模型
date:       2019-08-03
author:     正版慕言
header-img: img/blog_bg_3.jpg
catalog: true
tags:
    - 机器学习
    - 西瓜书
    - 概率图模型

---

> 概率图模型是一类用图来表达变量相关关系的概率模型。最常见的是用一个节点表示一个或一组随机变量，节点之间的边表示变量间的概率相关关系，即“变量关系图”。
> 根据边的性质不同，概率图模型可以分为两大类：
> 
> * 使用有向无环图表示变量之间的依赖关系，称为有向图模型或贝叶斯网
> * 使用无向图辨识变量之间的相关关系，称为无向图模型或马尔可夫网

#### 隐马尔可夫模型

隐马尔可夫模型（HMM）是结构最简单的动态贝叶斯网，是一种著名的有向图模型。
![西瓜书-14.隐马尔可夫模型.png](/img/西瓜书-14.隐马尔可夫模型.png)
隐马尔可夫模型中变量分为两组：一组是状态变量{y1,y2,...,yn},yi属于Y表示第i时刻的系统状态，称“隐变量”；一组是观测变量{x1,x2,...,xn}，xi∈X表示第i时刻的观测值。箭头表示变量间的依赖关系。在任一时刻，观测变量的取值仅依赖于其对应的状态变量。同时，t时刻的状态变量只由前一时刻的状态变量决定。
> 马尔可夫链：系统下一时刻的状态仅有当前状态决定，不依赖于以往的任何状态。

基于这种关系，可以得到所有变量的联合概率分布：
![西瓜书-14.马尔可夫链的联合概率分布.gif](/img/西瓜书-14.马尔可夫链的联合概率分布.gif)

除了结构信息，还需要一下3组参数来确定一个隐马尔科夫模型：

* 状态转移概率：模型在各个状态之间转换的概率 矩阵A
![西瓜书-14.状态转移概率.gif](/img/西瓜书-14.状态转移概率.gif)
表示在任意时刻t，若状态为si，下一时刻状态为sj的概率。
* 输出观测概率：模型根据当前状态获得各个观测值的概率 矩阵B
![西瓜书-14.输出观测概率.gif](/img/西瓜书-14.输出观测概率.gif)
表示在任一时刻t，若状态为si，则观测值oj被获取的概率。
* 初始状态概率：模型在初始时各状态出现的概率 **π** = (π1, π2, ..., πN)
![西瓜书-14.初始状态概率.gif](/img/西瓜书-14.初始状态概率.gif)
表示模型初始状态为si的概率。

通过指定状态空间 Y、观测空间 X 和上述三组概率参数，就能确定一个隐马尔可夫模型λ = [A,B,π]。具体的步骤为：

1. 设置t = 1，根据初始状态概率π选择初始状态y1；
2. 根据状态yt和输出观测概率B选择观测变量取值xt；
3. 根据状态yt和状态转移矩阵A确定y t+1；
4. 若t<n，令t = t+1，转到第2步，否则停止。

实际应用中，人们常关注隐马尔可夫模型的三个基本问题：

* 给定模型λ = [A,B,π]，如何有效计算产生观测序列x = {x1,x2,...,xn}的概率P(x|λ)
* 给定模型λ = [A,B,π]和观测序列x = {x1,x2,...,xn}，如何找到与此观测序列最匹配的状态序列y = {y1,y2,...,yn}
* 给定观测序列x = {x1,x2,...,xn}，如何调整模型参数λ = [A,B,π]使该序列出现的概率P(x|λ)最大

#### 马尔可夫随机场MRF
马尔可夫随机场（MRF）是典型的马尔可夫网，是一种著名的无向图。图中每个节点表示一个或一组变量，节点间的边表示变量间的依赖关系。马尔可夫随机场有一组势函数（或称“因子”），是定义在变量子集上的非负实函数，主要用于定义概率分布函数。

> 团：对图中节点的一个子集，若其中任意两个节点之间都有边连接，则称该节点子集为一个团。

> 极大团：若在一个团中加入任意一个节点都不再形成团，则该团称为“极大团”。

> 马尔可夫随机场的联合概率：![西瓜书-14.马尔可夫随机场的联合概率.gif](/img/西瓜书-14.马尔可夫随机场的联合概率.gif)

一个简单的马尔可夫随机场：
![西瓜书-14.一个简单的马尔可夫模型.png](/img/西瓜书-14.一个简单的马尔可夫模型.png)

> 全局马尔可夫性：给定两个变量子集的分离集，则这两个变量子集条件独立。例：
> ![西瓜书-14.全局马尔可夫性.png](/img/西瓜书-14.全局马尔可夫性.png)
> A与B条件独立。

由全局马尔可夫性可得到两个有用的推论：
> 局部马尔可夫性：给定某变量的邻接变量，则该变量条件独立于其它变量。

> 成对马尔可夫性：给定所有其它变量，两个非邻接变量条件独立。

#### 条件随机场CRF
条件随机场是一种判别式无向图模型。
生成式模型直接对联合分布进行建模，判别式模型则是对条件分布进行建模。

条件随机场试图对多个变量在给定观测值后的条件概率进行建模。
令x = {x1,x2,...,xn}，y = {y1,y2,...,yn}，条件随机场的目标是构建概率模型P(y|x)。
对无向图G = (V, E)，yv表示节点v对应的标记变量，n(v)表示v的邻接节点，如果图G中的每个yv都满足马尔可夫性，则(y,x)构成一个条件随机场。

现实应用中常用的是链式条件随机场。例：
![西瓜书-14.链式条件随机场.png](/img/西瓜书-14.链式条件随机场.png)
条件随机场也使用势函数和图结构上的团来定义条件概率
![西瓜书-14.条件随机场的联合概率.gif](/img/西瓜书-14.条件随机场的联合概率.gif)
其中ti(y_i+1,yi,x,i)是定义在观测序列的两个相邻标记位置上的转移特征函数，用于刻画相邻标记变量之间的相关关系以及观测数据对他们的影响。sk(yi,x,i)是定义在观测序列的标记位置i上的状态特征函数，用于刻画观测序列对标记变量的影响。

*条件随机场处理的是条件概率，马尔可夫随机场处理的是联合概率。*

#### 学习与推断
基于概率图模型定义的联合概率分布，我们能对目标变量的边际分布或以某些可观测变量为条件的条件分布进行推断。
边际分布指对无关变量求和或积分后的结果。

概率图模型的推断方法大致分为两类：

* 精确推断方法：希望能计算出目标变量的边际分布或条件分布的精确值
* 近似推断方法：希望在较低的时间复杂度下获得原问题的近似解。在现实任务中更常用。

这里先介绍两种**精确推断**方法。

1. 变量消去
变量消去法是最直接的精确推断算法，也是构建其他精确算法的基础。
![西瓜书-14.变量消去法及对应的消息传递过程.png](/img/西瓜书-14.变量消去法及对应的消息传递过程.png)
以上图为例，假定推断目标的计算边际概率P(x5)
![西瓜书-14.变量消去.gif](/img/西瓜书-14.变量消去.gif)
mij(xj)是求加的中间结果，下标i表示是对xi求加的结果。
可以看到最后的结果是关于x5的函数，仅与x5的取值有关。

    上述方法对无向图模型同样适用。

    变量消去有一个明显的缺点：如果要计算多个边际分布，重复使用变量消去法会造成大量的冗余计算。
    
2. 信念传播
信念传播算法将变量消去法中的求和操作看做一个消息传递过程，较好地解决了求解多个边际分布时的重复计算问题。
在信念传播算法中，一个节点仅在接收到来自其他所有节点的消息后才能向另一个节点发送消息，且节点的边际分布正比于它所接收的消息的乘积。
如果结构图中没有环，信念传播算法经过两个步骤就可以完成所有消息传递，进而能计算所有变量上的边际分布：

    * 指定一个根节点，从所有叶节点开始向根节点传递消息，直到根节点收到所有邻接节点的消息。
    * 从根节点开始向叶节点传递消息，直到所有叶节点都收到消息。
    
    ![西瓜书-14.信念传播算法.png](/img/西瓜书-14.信念传播算法.png)
    
#### 近似推断
精确推断方法通常需要很大的计算开销，因此在现实应用中近似推断方法更为常用。近似推断方法可分为两大类：1.采样，通过使用随机化方法完成近似；2.使用确定性近似完成近似推断，典型代表为变分推断。
1. MCMC采样
在很多任务中我们关心的是在概率分布下的某一个变量的期望，而不是概率分布本身。直接计算或逼近期望比推断概率分布更容易。
马尔可夫链蒙特卡罗（MCMC）方法是概率图模型中常用的采样技术。
MCMC方法先设法搜造一条马尔可夫链，使其收敛至平稳分布恰好为待估计参数的后验分布，然后通过这条马尔可夫链产生符合后验分布的样本，并基于这些样本来进行估计。Metropolis-Hastings(MH)算法是MCMC的重要代表，它基于“拒绝采样”来逼近平稳分布p。
![西瓜书-14.MH算法.png](/img/西瓜书-14.MH算法.png)
吉布斯采样被视为MH算法的特例。

2. 变分推断
变分推断通过使用已知简单分布来逼近需推断的复杂分布，并通过限制近似分布的类型，得到一种局部最优但具有确定解的近似后验分布。
变分推断使用的近似分布需要有良好的数学性质，通常是基于连续性变量的概率密度函数。
假设由N个可观测变量x1, x2, ..., xN都依赖于其它变量z，且x与z均服从分布参数θ。这样一来，我们根据概率图模型的推断与学习任务主要是由x来估计z和分布参数变量θ，即求解p(z|x,θ)和θ。
通常使用极大似然函数和EM算法进行推断，但在现实任务中，推断的过程可能会因为z过于复杂难以进行。此时可以借助变分推断，假设隐变量z副总分布q。
通过使用简单或结构更好的分布q去近似z的后验分布p(z|x,θ)，能够在节省计算开销的情况下得到所要的概率分布。

#### 话题模型
话题模型是一族生成式有向图模型，主要用于处理离散型的数据。隐狄利克雷分配模型（LDA）是话题模型的典型代表。
话题模型涉及到的几个概念：
> 词：待处理数据的基本离散单元
> 文档：待处理的数据对象，它由一组词组成
> 话题：话题表示一个概念，具体表示为一系列与该概念相关的词，以及它们在该概念下出现的概率。
> 词袋：文档的表示方式，将文档中的词不计顺序的存储成一个词的集合。

现实任务中，我们可以通过统计文档中的词来获得词频向量W，当我们通常不清楚这组文档都谈论了哪些话题，也不知道每篇文档与哪些话题有关。LDA从生成式模型的角度来看待文档和话题。LDA认为每篇文档包含多个话题，用向量θt属于R^k表示文档t中包含的每个话题的比例，θt,k表示文档t中包含话题k的比例，通过下面的步骤生成文档t：

1. 根据参数为α的狄利克雷分布随机采样一个话题分布θt
2. 按如下步骤生成文档中的N个词
![西瓜书-14.LDA的文档生成过程.png](/img/西瓜书-14.LDA的文档生成过程.png)
