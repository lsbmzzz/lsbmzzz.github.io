---
layout:     post
title:      BP神经网络原理
subtitle:   BP神经网络原理
date:       2019-08-19
author:     正版慕言
header-img: img/blog_bg_1.jpg
catalog: true
tags:
    - BP神经网络

---

> BP，Back Propagation 

![590fa20f4fcede1b5fa2141563dc337c.png](/img/Journal/BP/一个单隐层BP网络.png)
（图中未包含bias）

这个网络的工作原理：

#### 前向传播
1. 一组输入![d50af5ebfb600ae5f8bc41c81ff2d5ff.gif](/img/Journal/BP/x1-xm.gif)来到输入层
2. 通过与隐层的连接的权重，产生一组![46c448235ef09e21c1f74223eab25b13.gif](/img/Journal/BP/s1-sn.gif)作为隐层的输入
3. 通过隐层节点的θ激活函数输出![9eacb1854044c7daad1881c207eb016f.gif](/img/Journal/BP/θsj.gif)
4. 将这些输出通过隐层与输出层的连接权重，产生输出层的输入
5. 通过输出层的激活函数θ，输出![d4312d3f664a15f4209dcd5eef847c36.gif](/img/Journal/BP/ybarj.gif)

#### 反向传播
输入数据是已知的，那么影像输出的就是那些连接的权重了。反向传播的任务就是调整这些连接权重，让它们向正确的方向变化。
对于给定的训练样本，我们已经知道正确结果，那么从输入经过网络得到的输出与正确结果之间会有一个误差。将这个误差降低到最小，就是输出结果接近了正确结果。怎么让误差最小呢？

**写出误差表达式**。这里使用最小化均方根误差（使函数连续可导），定义损失函数：![e589925104c90c0c6ef0c0b1cb2d6e54.gif](/img/Journal/BP/平方误差.gif)
**怎么最小化L**？可以采用随机梯度下降SGD。对每个训练样本都使权重往其负梯度方向变化。
1. ![5f58509050bf8391a11c9c9551c3121b.gif](/img/Journal/BP/BP中的w和s表示.gif)分别表示输入层第i个节点到隐层第j个节点的权重、隐层第i个节点到输出层第j个节点的权重、隐层第j个几点的输入、输出层第j个节点的输入。（用上标表示层数）
2. 基于这种表示，有
![23f3dbeec1fc9e4271d61b9a419936a4.gif](/img/Journal/BP/BP的xi.gif)
3. 此时只要计算L对s的偏导即可。由于s对所有输出层都有影响，所以有
![ca2a8f370e2a521e663312365a42c6d3.gif](/img/Journal/BP/反向传播e.gif)
这里可以看到，反向传播的就是误差e。

反向传播的过程：输出层的每个节点都会得到一个误差e，把e作为输出层的反向输入（相当于输出层当成输入层）把e向回传播，先得到输出层的δ，然后根据连接权重w向隐层传输，就得到隐层δ：![827fed6553b13fb190b01819523a9621.gif](/img/Journal/BP/隐层δ.gif)

第一层的权重梯度：![75fe6ebcf0ec65d720d27f81df84b9ea.gif](/img/Journal/BP/第一层权重梯度.gif)
第二层权重梯度：![8c27882090e7e99203a9c64a5ef8d378.gif](/img/Journal/BP/第二层权重梯度.gif)

可以看到，**每个权重的梯度都等于与其相连的前一层节点的输出乘以与其相连的后一层的反向传播的输出**。
反向传播得到所有的δ以后，就可以更新权重了。
下图是一个BP神经网络工作过程
![7e27959b73b46780dfb3a635fa1d188c.png](/img/Journal/BP/BP神经网络工作过程.png)
图中，每一个节点的输出都和权重矩阵中对应同一列（行）的元素相乘，然后同一行（列）累加，作为下一层对应节点的输入。
单个节点的抽象示意图：
![714237a8ea053b9bea599632ddb42871.png](/img/Journal/BP/单个节点的抽象.png)

#### 一些常用的激活函数
激活函数θ可以使用的有Sigmoid、tanh、ReLU、Leaky ReLU等。
![667175ea0691284be0df3587d6297a09.gif](/img/Journal/BP/常用激活函数.gif)
